
一、零拷贝技术（Zero Copy）

	1、概念
	零拷贝是一种高效的计算机I/O技术，它的目标是在数据传输过程中尽可能减少不必要的数据复制（拷贝）操作，从而提高数据传输的效率并减少 CPU 的负担。传统的数据传输方法通常会在数据从源（比如磁盘、网络等）到目标（比如内存、应用程序等）过程中多次进行内存拷贝，这会占用 CPU 时间并降低系统性能。零拷贝技术通过避免这些中间的拷贝步骤，显著提高了数据传输的效率。
	
	2、实现机制
	零拷贝的核心思想是让数据在内核和用户空间之间、或在不同的内核缓冲区之间直接传输，而不经过 CPU 和内存的中间拷贝过程。为了实现这一目标，操作系统提供了一些特殊的系统调用和底层机制。例如：
	
	（1）内存映射（mmap）
		通过内存映射系统调用，应用程序可以将文件或设备的内容映射到进程的虚拟内存空间，从而避免了从磁盘到内存的复制过程。
		
		具体来说：
			- 文件被直接映射到用户空间的虚拟地址。
			- 当应用程序访问这些地址时，操作系统会在后台加载数据而不需要额外的数据复制。
			- 数据可以通过内存映射直接读取或写入，不经过应用程序的缓冲区。
	
	（2）发送文件（sendfile）
		sendfile允许操作系统直接将文件内容从文件描述符发送到网络socket，而不需要将文件数据复制到应用程序的缓冲区。通过sendfile，数据可以直接在内核空间之间传输，从而提高I/O性能。

		基本原理：
			- 操作系统会直接将文件从文件系统缓存（或者磁盘）发送到网络 socket。
			- 数据在内核中被移动，而不需要通过用户空间的中间缓冲区进行拷贝。
	
	零拷贝技术通过减少数据在内核和用户空间之间的拷贝操作，显著提高了 I/O 性能，降低了CPU使用率，并减少了内存带宽的压力。它广泛应用于需要高性能数据传输的场景，如 Web服务器、视频流媒体、数据库、大数据处理和高吞吐量网络应用。通过技术手段如内存映射mmap、sendfile系统调用、Direct I/O 等，零拷贝极大提升了大规模数据处理的效率和性能。

二、IO多路复用技术

	1、概念

		IO多路复用是一种在一个线程中同时监听多个IO事件的方法。当任何一个文件描述符上有数据可读或可写时，IO多路复用会通知应用程序去处理该事件。常见的IO多路复用包括select、poll和epoll。

	2、IO多路复用的实现方式
		
	IO 多路复用通过一系列系统调用来实现，最常见的几种实现方式有：
	
	（1）select
	
		select是最早实现的I/O多路复用机制，它通过传入一个文件描述符集合，检查哪个文件描述符可用，然后返回可以执行I/O操作的文件描述符集合。
		
		优点：支持广泛，几乎所有操作系统都支持。
		缺点：每次调用时都需要重新传递文件描述符集，然后遍历集合，来找到就绪的文件描述符，效率较低。而且，文件描述符的数量有限制，通常最多支持 1024 个文件描述符。


	（2）poll
	
		poll和select类似，它也是通过传入一个‘文件描述符集合’来监听事件；使用链表来存储文件描述符，没有文件描述符数量的限制，且内部实现更为高效。

		优点：没有文件描述符限制，比select更灵活。
		缺点：每次调用都需要遍历整个文件描述符集，性能较差，尤其是在文件描述符数量非常多时。

	(3) epoll（重点）
		
		epoll是Linux上的高效 I/O 多路复用机制，它使用一个事件通知机制（即在文件描述符有状态变化时，将只返回变化的文件描述符，而不是遍历整个文件描述符集合）不需要每次调用都遍历文件描述符列表。epoll是基于事件的，而且支持边缘触发（edge-triggered）和水平触发（level-triggered）模式。

		优点：高效，不需要不断传递文件描述符，不需要遍历；
			  没有最大并发连接数量的限制，支持大量的并发连接；
		缺点：仅支持Linux系统，且相对较复杂，使用时需要管理好事件的触发条件。

		在epoll中，事件通知机有两种模式：“水平出发”、“边缘触发”。这两种模式决定了epoll如何通知应用程序处理IO事件。

		（3.1）水平触发LT：
		
			是epoll默认模式，只要文件描述符处于就绪状态（比如，缓冲区中有数据可以读取），就会不断返回该事件。即应用程序可以多次获取同一个就绪的文件描述符事件，直到事件处理完毕。
		
		工作机制：
		（1）文件描述符状态变化时触发：每次调用 epoll_wait 时，若文件描述符处于就绪状态，epoll 会将其返回。
		（2）重复通知：如果应用程序没有处理文件描述符的就绪状态（例如，读取完所有数据），epoll_wait 会在下一次调用时再次返回该文件描述符，直到就绪状态被清除（例如，数据被完全读取）

		优点：简单，适合处理大量 IO 事件，因为不会错过任何就绪事件。
		缺点：会重复返回同一个事件，增加了系统调用次数，性能可能受影响。


		（3.2）边缘触发ET
		
			边缘触发是一种高效的触发模式，适合性能要求高的场景。与水平触发不同，边缘触发仅在文件描述符状态发生边缘变化时（例如，从不可读到可读）通知一次。也就是说，如果缓冲区有新数据到达，epoll仅会通知一次，不会持续通知。

		工作机制：
		（1）状态变化时触发：边缘触发只在文件描述符的状态从不可读到可读、或不可写到可写时通知一次。
		（2）不重复通知：如果应用程序在收到通知后没有将数据读完，那么在数据再次变化前不会收到新的通知。这意味着应用程序必须一次性将数据全部读取，否则会错过后续的事件通知。

		优点：减少了重复通知，性能更高，适合高并发场景。
		缺点：开发难度更高，应用程序必须一次性将数据读完，否则可能错过事件通知，导致数据读取不完整。

		（3.3）两种触发模式的对比
	
![[截屏2024-12-06 16.58.00.png]]
	
	一般场景（水平触发）：水平触发模式适合大部分IO操作，因为它简单可靠。尤其在低并发场景下，水平触发模式便于实现，不容易遗漏事件。
	
	高性能场景（边缘触发）：在高并发场景下，边缘触发模式具有更高的性能，但要求程序确保数据一次性读取完毕，代码实现较复杂。适用于高性能服务器的设计，比如Nginx和Redis服务器。

	总结来说，水平触发模式适合简单易用的场景，边缘触发模式则适用于追求性能的高并发系统。在实际开发中，选择触发模式时应综合考虑系统的并发量、对性能的要求以及代码的复杂度。


	（4）三者对比
	
![[截屏2024-12-06 16.42.12.png]]