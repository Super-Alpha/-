
1、主从同步原理
![[Pasted image 20241205203458.png]]
	
	（1）主库的更新事件（update、insert、delete）被写到binlog中；
	（2）从库发起连接，连接到主库;
	（3）主库创建一个binlog dump thread，把binlog的内容发送到从库；
	（4）从库启动后，创建一个IO线程，读取主库传过来的binlog内容，并写入本地的relay log日志中；
	（5）从库创建一个SQL线程，从relay log中读取内容，开始执行读取到的更新事件，将更新内容写入到本地。

2、主从同步延迟的常见原因
		
	（1）网络延迟；
	（2）主服务器写入负载过高
		当主服务器的写入负载过高时，主服务器生成的二进制日志binlog会增多，导致从服务器无法及时处理这些日志。写入量大的情况下，主服务器的IO操作会变得繁重，从而导致从服务器无法跟上主服务器的写入速度，进而导致延迟；
	（3）从服务器性能不足；
	（4）从服务器IO线程处理能力不足；
	（5）慢查询/大事务影响性能；

3、binlog的三中录入方式
	
	（1）Statement
		基于SQL语句的复制，在binlog中记录的是每一条会修改数据的SQL语句。
		
		优点：日志量小，节省IO和存储
		缺点：在主从复制场景下，可能导致主从数据不一致
	
	（2）Row
		基于行的复制，记录每一行数据被修改的情况。
		
		优点：能准确地记录每一行数据的变化，在主从复制时更加安全可靠，能避免STATEMENT格式中因函数等导致的主从数据不一致问题。
		缺点：日志量较大，特别是对于批量操作时，会记录大量的行级变更，比较耗费I/O和存储
	
	（3）Mixed
		混合模式，MySQL会根据SQL语句自动判断使用STATEMENT还是ROW格式。
		
		优点：结合了STATEMENT格式节省空间和ROW格式安全可靠的优点。默认使用STATEMENT格式记录日志，但在遇到非确定性函数等可能导致主从数据不一致的情况时会自动切换到ROW格式。

4、主从复制模式
	
	（1）异步复制
		在异步复制模式下，主服务器将数据写入 binlog（binary log）后，立即向客户端返回响应，而不等待从服务器确认是否接收到数据。数据复制发生在从服务器从主服务器的 binlog 中读取并应用数据时。
		
	（2）半同步复制
		主服务器在提交事务前，至少等待一个从服务器确认已接收到事务的日志。此时，主服务器不会立即返回响应，而是等待从服务器确认数据已经接收。这种方式能够在主服务器宕机时最大程度地减少数据丢失。
		
	（3）同步复制
		 在同步复制模式下，主服务器与所有从服务器之间的复制是同步的。主服务器在提交事务前，等待所有的从服务器都确认接收到数据，并应用数据。